<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ANITS | Admin Dashboard</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body class="admin-page">
    <%- include('../partials/admin-navbar', { currentPage: 'dashboard' }) %>

    <!-- Main Content -->
    <main class="container-fluid px-4 section-padding">
      <!-- Page Header -->
      <div class="admin-page-header">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h1 class="admin-page-title">
              <i class="fas fa-tachometer-alt me-3"></i>Dashboard Overview
            </h1>
            <p class="admin-page-subtitle mb-0">
              Welcome back, <%= session.adminName || 'Admin' %>! Here's what's
              happening today.
            </p>
          </div>
          <div class="col-md-4 text-md-end mt-3 mt-md-0">
            <span class="badge bg-success p-2 px-3">
              <i
                class="fas fa-circle fa-xs me-2"
                style="animation: pulse 2s infinite"
              ></i
              >System Active
            </span>
          </div>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div class="row g-4 mb-4">
        <div class="col-md-6 col-xl-3">
          <div class="stat-card">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <p class="stat-label mb-2">Total Complaints</p>
                <h2 class="stat-value text-primary"><%= stats.total || 0 %></h2>
                <p class="text-muted small mb-0">
                  <i class="fas fa-arrow-up text-success me-1"></i>
                  <span class="text-success">+12%</span> from last month
                </p>
              </div>
              <div
                class="stat-icon"
                style="background: linear-gradient(135deg, #667eea, #764ba2)"
              >
                <i class="fas fa-file-alt"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-xl-3">
          <div class="stat-card" style="border-left-color: #ffc107">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <p class="stat-label mb-2">Pending Review</p>
                <h2 class="stat-value text-warning">
                  <%= stats.pending || 0 %>
                </h2>
                <p class="text-muted small mb-0">
                  <i class="fas fa-clock me-1"></i>
                  Requires attention
                </p>
              </div>
              <div
                class="stat-icon"
                style="background: linear-gradient(135deg, #f093fb, #f5576c)"
              >
                <i class="fas fa-clock"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-xl-3">
          <div class="stat-card" style="border-left-color: #17a2b8">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <p class="stat-label mb-2">In Progress</p>
                <h2 class="stat-value text-info">
                  <%= stats.inProgress || 0 %>
                </h2>
                <p class="text-muted small mb-0">
                  <i class="fas fa-spinner me-1"></i>
                  Under investigation
                </p>
              </div>
              <div
                class="stat-icon"
                style="background: linear-gradient(135deg, #4facfe, #00f2fe)"
              >
                <i class="fas fa-tasks"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-xl-3">
          <div class="stat-card" style="border-left-color: #28a745">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <p class="stat-label mb-2">Resolved</p>
                <h2 class="stat-value text-success">
                  <%= stats.resolved || 0 %>
                </h2>
                <p class="text-muted small mb-0">
                  <i class="fas fa-check-circle me-1"></i>
                  Successfully closed
                </p>
              </div>
              <div
                class="stat-icon"
                style="background: linear-gradient(135deg, #43e97b, #38f9d7)"
              >
                <i class="fas fa-check-circle"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="row g-4 mb-4">
        <div class="col-12">
          <div class="admin-card">
            <div class="card-body p-4">
              <h5 class="fw-bold mb-4">
                <i class="fas fa-bolt me-2 text-warning"></i>Quick Actions
              </h5>
              <div class="row g-3">
                <div class="col-md-3">
                  <a href="/admin/complaints" class="quick-action-btn">
                    <div class="quick-action-icon">
                      <i class="fas fa-inbox"></i>
                    </div>
                    <p class="quick-action-label">View All Complaints</p>
                  </a>
                </div>
                <div class="col-md-3">
                  <a href="/admin/sos-alerts" class="quick-action-btn">
                    <div class="quick-action-icon text-danger">
                      <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <p class="quick-action-label">SOS Alerts</p>
                  </a>
                </div>
                <div class="col-md-3">
                  <a href="/admin/analytics" class="quick-action-btn">
                    <div class="quick-action-icon text-info">
                      <i class="fas fa-chart-line"></i>
                    </div>
                    <p class="quick-action-label">View Analytics</p>
                  </a>
                </div>
                <div class="col-md-3">
                  <a href="/admin/activity-logs" class="quick-action-btn">
                    <div class="quick-action-icon text-secondary">
                      <i class="fas fa-history"></i>
                    </div>
                    <p class="quick-action-label">Activity Logs</p>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-4">
        <!-- Recent Complaints -->
        <div class="col-xl-8">
          <div class="admin-card">
            <div class="admin-card-header">
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                  <i class="fas fa-list me-2"></i>Recent Complaints
                </h5>
                <a href="/admin/complaints" class="btn btn-sm btn-light">
                  View All <i class="fas fa-arrow-right ms-1"></i>
                </a>
              </div>
            </div>
            <div class="card-body p-0">
              <% if (recentComplaints && recentComplaints.length > 0) { %>
              <div class="table-responsive">
                <table class="table admin-table mb-0">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Title</th>
                      <th>Severity</th>
                      <th>Status</th>
                      <th>Date</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% recentComplaints.slice(0, 5).forEach(complaint => { %>
                    <tr>
                      <td>
                        <span class="font-monospace small"
                          ><%= complaint.complaintId.substring(0, 12)
                          %>...</span
                        >
                      </td>
                      <td>
                        <strong
                          ><%= complaint.title.substring(0, 40) %><%=
                          complaint.title.length > 40 ? '...' : '' %></strong
                        >
                      </td>
                      <td>
                        <% let severityColor = 'warning'; if (complaint.severity
                        === 'High') severityColor = 'danger'; if
                        (complaint.severity === 'Low') severityColor =
                        'success'; %>
                        <span
                          class="badge bg-<%= severityColor %> badge-status"
                        >
                          <%= complaint.severity %>
                        </span>
                      </td>
                      <td>
                        <% let statusColor = 'warning'; if (complaint.status ===
                        'Resolved') statusColor = 'success'; if
                        (complaint.status === 'In Progress') statusColor =
                        'info'; if (complaint.status === 'Rejected') statusColor
                        = 'danger'; %>
                        <span class="badge bg-<%= statusColor %> badge-status">
                          <%= complaint.status %>
                        </span>
                      </td>
                      <td>
                        <small
                          ><%= new
                          Date(complaint.createdAt).toLocaleDateString()
                          %></small
                        >
                      </td>
                    </tr>
                    <% }) %>
                  </tbody>
                </table>
              </div>
              <% } else { %>
              <div class="text-center py-5">
                <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                <p class="text-muted">No complaints yet</p>
              </div>
              <% } %>
            </div>
          </div>
        </div>

        <!-- Severity Distribution -->
        <div class="col-xl-4">
          <div class="admin-card mb-4">
            <div class="admin-card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-pie me-2"></i>Severity Distribution
              </h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <div
                  class="d-flex justify-content-between align-items-center mb-2"
                >
                  <span class="text-muted">High Severity</span>
                  <span class="fw-bold text-danger"
                    ><%= stats.high || 0 %></span
                  >
                </div>
                <div class="progress" style="height: 10px">
                  <div
                    class="progress-bar bg-danger"
                    role="progressbar"
                    style="width: <%= stats.total > 0 ? (stats.high / stats.total * 100) : 0 %>%"
                  ></div>
                </div>
              </div>
              <div class="mb-3">
                <div
                  class="d-flex justify-content-between align-items-center mb-2"
                >
                  <span class="text-muted">Medium Severity</span>
                  <span class="fw-bold text-warning"
                    ><%= stats.medium || 0 %></span
                  >
                </div>
                <div class="progress" style="height: 10px">
                  <div
                    class="progress-bar bg-warning"
                    role="progressbar"
                    style="width: <%= stats.total > 0 ? (stats.medium / stats.total * 100) : 0 %>%"
                  ></div>
                </div>
              </div>
              <div>
                <div
                  class="d-flex justify-content-between align-items-center mb-2"
                >
                  <span class="text-muted">Low Severity</span>
                  <span class="fw-bold text-success"
                    ><%= stats.low || 0 %></span
                  >
                </div>
                <div class="progress" style="height: 10px">
                  <div
                    class="progress-bar bg-success"
                    role="progressbar"
                    style="width: <%= stats.total > 0 ? (stats.low / stats.total * 100) : 0 %>%"
                  ></div>
                </div>
              </div>
            </div>
          </div>

          <!-- System Info -->
          <div class="admin-card">
            <div class="card-body">
              <h6 class="fw-bold mb-3">
                <i class="fas fa-info-circle me-2"></i>System Information
              </h6>
              <div class="mb-2">
                <small class="text-muted">Last Login:</small>
                <div class="fw-bold"><%= new Date().toLocaleString() %></div>
              </div>
              <div class="mb-2">
                <small class="text-muted">Your Role:</small>
                <div class="fw-bold">Administrator</div>
              </div>
              <div>
                <small class="text-muted">Active Users:</small>
                <div class="fw-bold">1 Admin Online</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/main.js"></script>

    <style>
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
      }
    </style>
  </body>
</html>
