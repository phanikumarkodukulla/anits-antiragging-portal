<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body class="admin-page">
    <%- include('../partials/admin-navbar', { currentPage: 'profile' }) %>

    <div class="container-fluid px-4 py-4">
      <div
        class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
      >
        <h1 class="h2">Admin Profile</h1>
      </div>

      <div class="row">
        <!-- Profile Info -->
        <div class="col-md-6">
          <div class="card mb-4">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">
                <i class="fas fa-user-circle me-2"></i>Profile Information
              </h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <strong>Full Name:</strong>
                <p><%= admin.fullName %></p>
              </div>
              <div class="mb-3">
                <strong>Email:</strong>
                <p><%= admin.email %></p>
              </div>
              <div class="mb-3">
                <strong>Role:</strong>
                <p>
                  <span class="badge bg-success"><%= admin.role %></span>
                </p>
              </div>
              <div class="mb-3">
                <strong>Account Created:</strong>
                <p><%= new Date(admin.createdAt).toLocaleString() %></p>
              </div>
              <div class="mb-3">
                <strong>Last Login:</strong>
                <p>
                  <%= admin.lastLogin ? new
                  Date(admin.lastLogin).toLocaleString() : 'N/A' %>
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Change Password -->
        <div class="col-md-6">
          <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
              <h5 class="mb-0">
                <i class="fas fa-key me-2"></i>Change Password
              </h5>
            </div>
            <div class="card-body">
              <% if (typeof error !== 'undefined' && error) { %>
              <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i><%= error %>
              </div>
              <% } %> <% if (typeof success !== 'undefined' && success) { %>
              <div class="alert alert-success">
                <i class="fas fa-check-circle me-2"></i><%= success %>
              </div>
              <% } %>

              <form action="/admin/profile/change-password" method="POST">
                <div class="mb-3">
                  <label class="form-label fw-bold">Current Password</label>
                  <input
                    type="password"
                    class="form-control"
                    name="currentPassword"
                    required
                  />
                </div>

                <div class="mb-3">
                  <label class="form-label fw-bold">New Password</label>
                  <input
                    type="password"
                    class="form-control"
                    name="newPassword"
                    minlength="6"
                    required
                  />
                  <small class="text-muted">Minimum 6 characters</small>
                </div>

                <div class="mb-3">
                  <label class="form-label fw-bold">Confirm New Password</label>
                  <input
                    type="password"
                    class="form-control"
                    name="confirmPassword"
                    minlength="6"
                    required
                  />
                </div>

                <button type="submit" class="btn btn-warning w-100">
                  <i class="fas fa-save me-2"></i>Change Password
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Activity Summary -->
      <div class="row">
        <div class="col-md-12">
          <div class="card mb-4">
            <div class="card-header bg-info text-white">
              <h5 class="mb-0">
                <i class="fas fa-chart-line me-2"></i>Your Activity Summary
              </h5>
            </div>
            <div class="card-body">
              <div class="row text-center">
                <div class="col-md-3">
                  <div class="p-3 border rounded">
                    <i class="fas fa-file-alt fa-2x text-primary mb-2"></i>
                    <h3 class="text-primary"><%= complaintsHandled %></h3>
                    <p class="mb-0 small">Complaints Handled</p>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="p-3 border rounded">
                    <i class="fas fa-tasks fa-2x text-success mb-2"></i>
                    <h3 class="text-success"><%= actionsThisWeek %></h3>
                    <p class="mb-0 small">Actions This Week</p>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="p-3 border rounded">
                    <i class="fas fa-sign-in-alt fa-2x text-warning mb-2"></i>
                    <h3 class="text-warning"><%= totalLogins %></h3>
                    <p class="mb-0 small">Total Logins</p>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="p-3 border rounded">
                    <i class="fas fa-calendar-check fa-2x text-info mb-2"></i>
                    <h3 class="text-info"><%= actionsToday || 0 %></h3>
                    <p class="mb-0 small">Actions Today</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header bg-secondary text-white">
              <h5 class="mb-0">
                <i class="fas fa-history me-2"></i>Your Recent Activity
              </h5>
            </div>
            <div class="card-body">
              <% if (recentActivity && recentActivity.length > 0) { %>
              <div class="list-group list-group-flush">
                <% recentActivity.forEach(log => { %>
                <div class="list-group-item">
                  <div class="d-flex w-100 justify-content-between">
                    <h6 class="mb-1">
                      <% if (log.action === 'Login') { %>
                      <span class="badge bg-success me-2"
                        ><i class="fas fa-sign-in-alt"></i
                      ></span>
                      <% } else if (log.action === 'Updated Complaint') { %>
                      <span class="badge bg-primary me-2"
                        ><i class="fas fa-edit"></i
                      ></span>
                      <% } else if (log.action === 'Deleted Complaint') { %>
                      <span class="badge bg-danger me-2"
                        ><i class="fas fa-trash"></i
                      ></span>
                      <% } else if (log.action === 'Exported Data') { %>
                      <span class="badge bg-info me-2"
                        ><i class="fas fa-download"></i
                      ></span>
                      <% } else if (log.action === 'Changed Password') { %>
                      <span class="badge bg-warning me-2"
                        ><i class="fas fa-key"></i
                      ></span>
                      <% } else { %>
                      <span class="badge bg-secondary me-2"
                        ><i class="fas fa-circle"></i
                      ></span>
                      <% } %> <%= log.action %>
                    </h6>
                    <small class="text-muted"
                      ><%= new Date(log.timestamp).toLocaleString() %></small
                    >
                  </div>
                  <% if (log.details) { %>
                  <p class="mb-1 text-muted small"><%= log.details %></p>
                  <% } %> <% if (log.complaintId) { %>
                  <small class="text-primary">
                    <i class="fas fa-hashtag"></i> <%= log.complaintId %>
                  </small>
                  <% } %>
                </div>
                <% }) %>
              </div>
              <div class="text-center mt-3">
                <a
                  href="/admin/activity-logs"
                  class="btn btn-outline-secondary btn-sm"
                >
                  <i class="fas fa-history me-1"></i>View All Activity Logs
                </a>
              </div>
              <% } else { %>
              <p class="text-center text-muted py-4">
                <i class="fas fa-inbox fa-3x mb-3 d-block"></i>
                No recent activity
              </p>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
