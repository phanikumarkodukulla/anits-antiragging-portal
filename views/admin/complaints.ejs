<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body class="admin-page">
  
  <%- include('../partials/admin-navbar', { currentPage: 'complaints' }) %>

  <div class="container-fluid px-4 py-4">
    
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="mb-1 fw-bold">
          <i class="fas fa-file-alt me-2" style="color: var(--primary-blue);"></i>
          Manage Complaints
        </h2>
        <p class="text-muted mb-0">View, filter and manage all submitted complaints</p>
      </div>
      <div>
        <div class="btn-group">
          <a href="/admin/export/csv" class="btn btn-outline-success">
            <i class="fas fa-file-csv me-1"></i> CSV
          </a>
          <a href="/admin/export/excel" class="btn btn-outline-success">
            <i class="fas fa-file-excel me-1"></i> Excel
          </a>
          <a href="/admin/export/pdf" class="btn btn-outline-danger">
            <i class="fas fa-file-pdf me-1"></i> PDF
          </a>
        </div>
      </div>
    </div>

    <!-- Stats Overview -->
    <div class="row g-3 mb-4">
      <div class="col-md-3">
        <div class="admin-card text-center">
          <div class="mb-2">
            <i class="fas fa-list-alt fa-2x" style="color: var(--primary-blue);"></i>
          </div>
          <h4 class="fw-bold mb-0"><%= complaints.length %></h4>
          <small class="text-muted">Total Complaints</small>
        </div>
      </div>
      <div class="col-md-3">
        <div class="admin-card text-center">
          <div class="mb-2">
            <i class="fas fa-clock fa-2x" style="color: #ffc107;"></i>
          </div>
          <h4 class="fw-bold mb-0"><%= complaints.filter(c => c.status === 'Pending').length %></h4>
          <small class="text-muted">Pending Review</small>
        </div>
      </div>
      <div class="col-md-3">
        <div class="admin-card text-center">
          <div class="mb-2">
            <i class="fas fa-tasks fa-2x" style="color: #17a2b8;"></i>
          </div>
          <h4 class="fw-bold mb-0"><%= complaints.filter(c => c.status === 'In Review').length %></h4>
          <small class="text-muted">In Progress</small>
        </div>
      </div>
      <div class="col-md-3">
        <div class="admin-card text-center">
          <div class="mb-2">
            <i class="fas fa-check-circle fa-2x" style="color: #28a745;"></i>
          </div>
          <h4 class="fw-bold mb-0"><%= complaints.filter(c => c.status === 'Resolved').length %></h4>
          <small class="text-muted">Resolved</small>
        </div>
      </div>
    </div>

    <!-- Filters Card -->
    <div class="admin-card mb-4">
      <div class="d-flex align-items-center mb-3">
        <div class="me-3" style="width: 4px; height: 24px; background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark)); border-radius: 2px;"></div>
        <h5 class="mb-0 fw-bold">Filter & Search</h5>
      </div>
      
      <form action="/admin/complaints" method="GET" class="row g-3">
        <div class="col-md-4">
          <label class="form-label fw-semibold">
            <i class="fas fa-search me-1"></i> Search
          </label>
          <input type="text" class="form-control" name="search" 
                 placeholder="Search by ID, Email or Title..." 
                 value="<%= filters.search || '' %>">
        </div>
        
        <div class="col-md-2">
          <label class="form-label fw-semibold">
            <i class="fas fa-info-circle me-1"></i> Status
          </label>
          <select class="form-select" name="status">
            <option value="">All Status</option>
            <option value="Pending" <%= filters.status === 'Pending' ? 'selected' : '' %>>Pending</option>
            <option value="In Review" <%= filters.status === 'In Review' ? 'selected' : '' %>>In Review</option>
            <option value="Resolved" <%= filters.status === 'Resolved' ? 'selected' : '' %>>Resolved</option>
          </select>
        </div>
        
        <div class="col-md-2">
          <label class="form-label fw-semibold">
            <i class="fas fa-exclamation-triangle me-1"></i> Severity
          </label>
          <select class="form-select" name="severity">
            <option value="">All Severity</option>
            <option value="Low" <%= filters.severity === 'Low' ? 'selected' : '' %>>Low</option>
            <option value="Medium" <%= filters.severity === 'Medium' ? 'selected' : '' %>>Medium</option>
            <option value="High" <%= filters.severity === 'High' ? 'selected' : '' %>>High</option>
          </select>
        </div>
        
        <div class="col-md-2">
          <label class="form-label fw-semibold">
            <i class="fas fa-sort me-1"></i> Sort By
          </label>
          <select class="form-select" name="sort">
            <option value="">Newest First</option>
            <option value="oldest" <%= filters.sort === 'oldest' ? 'selected' : '' %>>Oldest First</option>
            <option value="severity" <%= filters.sort === 'severity' ? 'selected' : '' %>>By Severity</option>
          </select>
        </div>
        
        <div class="col-md-2 d-flex align-items-end gap-2">
          <button type="submit" class="btn btn-primary flex-fill">
            <i class="fas fa-filter me-1"></i>Apply
          </button>
          <a href="/admin/complaints" class="btn btn-outline-secondary">
            <i class="fas fa-redo"></i>
          </a>
        </div>
      </form>
    </div>

    <!-- Complaints Table -->
    <div class="admin-card">
      <div class="table-responsive">
        <table class="admin-table">
          <thead>
            <tr>
              <th style="width: 120px;">
                <i class="fas fa-hashtag me-1"></i> ID
              </th>
              <th>
                <i class="fas fa-envelope me-1"></i> Email
              </th>
              <th>
                <i class="fas fa-file-alt me-1"></i> Title
              </th>
              <th style="width: 140px;">
                <i class="fas fa-map-marker-alt me-1"></i> Location
              </th>
              <th style="width: 100px;">
                <i class="fas fa-exclamation-triangle me-1"></i> Severity
              </th>
              <th style="width: 120px;">
                <i class="fas fa-info-circle me-1"></i> Status
              </th>
              <th style="width: 120px;">
                <i class="fas fa-calendar me-1"></i> Date
              </th>
              <th style="width: 120px;" class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (complaints.length === 0) { %>
              <tr>
                <td colspan="8" class="text-center py-5">
                  <i class="fas fa-inbox fa-4x text-muted mb-3 d-block"></i>
                  <h5 class="text-muted">No complaints found</h5>
                  <p class="text-muted mb-0">Try adjusting your filters</p>
                </td>
              </tr>
            <% } else { %>
              <% complaints.forEach(complaint => { %>
                <tr>
                  <td>
                    <code class="bg-light px-2 py-1 rounded"><%= complaint.complaintId %></code>
                  </td>
                  <td>
                    <div class="d-flex align-items-center">
                      <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-2" 
                           style="width: 32px; height: 32px; flex-shrink: 0;">
                        <i class="fas fa-user" style="font-size: 14px; color: var(--primary-blue);"></i>
                      </div>
                      <small><%= complaint.email %></small>
                    </div>
                  </td>
                  <td>
                    <div class="text-truncate" style="max-width: 250px;" title="<%= complaint.title %>">
                      <%= complaint.title %>
                    </div>
                  </td>
                  <td>
                    <small><i class="fas fa-map-pin me-1 text-muted"></i><%= complaint.location %></small>
                  </td>
                  <td>
                    <% if (complaint.severity === 'High') { %>
                      <span class="badge rounded-pill" style="background: linear-gradient(135deg, #dc3545, #bd2130);">
                        <i class="fas fa-exclamation-circle me-1"></i>High
                      </span>
                    <% } else if (complaint.severity === 'Medium') { %>
                      <span class="badge rounded-pill" style="background: linear-gradient(135deg, #ffc107, #e0a800);">
                        <i class="fas fa-exclamation-triangle me-1"></i>Medium
                      </span>
                    <% } else { %>
                      <span class="badge rounded-pill" style="background: linear-gradient(135deg, #17a2b8, #138496);">
                        <i class="fas fa-info-circle me-1"></i>Low
                      </span>
                    <% } %>
                  </td>
                  <td>
                    <% if (complaint.status === 'Pending') { %>
                      <span class="badge bg-warning text-dark">
                        <i class="fas fa-clock me-1"></i>Pending
                      </span>
                    <% } else if (complaint.status === 'In Review') { %>
                      <span class="badge bg-info">
                        <i class="fas fa-tasks me-1"></i>In Review
                      </span>
                    <% } else { %>
                      <span class="badge bg-success">
                        <i class="fas fa-check-circle me-1"></i>Resolved
                      </span>
                    <% } %>
                  </td>
                  <td>
                    <small class="text-muted">
                      <%= new Date(complaint.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %>
                    </small>
                  </td>
                  <td class="text-center">
                    <a href="/admin/complaints/<%= complaint.complaintId %>" 
                       class="btn btn-sm btn-outline-primary" 
                       title="View Details">
                      <i class="fas fa-eye"></i>
                    </a>
                    <button onclick="if(confirm('Are you sure you want to delete this complaint?')) { document.getElementById('delete-<%= complaint.complaintId %>').submit(); }" 
                            class="btn btn-sm btn-outline-danger ms-1" 
                            title="Delete">
                      <i class="fas fa-trash-alt"></i>
                    </button>
                    <form id="delete-<%= complaint.complaintId %>" 
                          action="/admin/complaints/<%= complaint.complaintId %>/delete" 
                          method="POST" 
                          class="d-none">
                    </form>
                  </td>
                </tr>
              <% }) %>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
